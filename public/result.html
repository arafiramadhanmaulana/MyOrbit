<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Penjualan – Orbit</title>
  <meta http-equiv="Cache-Control" content="no-store" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Outfit', sans-serif;
      background: linear-gradient(to bottom, #680024, #ff0025);
    }
    .scroll-table th, .scroll-table td {
      padding: 12px 16px;
      font-size: 14px;
      white-space: nowrap;
    }
    .scroll-table tr:nth-child(even) {
      background-color: #fff5f5;
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center px-6 py-10">

  <div class="w-full max-w-7xl bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl p-6 space-y-6">

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="flex items-center gap-4">
        <img src="images/logo_orbit.png" alt="Orbit" class="w-36">
        <div>
          <h1 class="text-2xl md:text-3xl font-bold text-red-700">Data Penjualan</h1>
        </div>
      </div>
      <div class="flex gap-3">
        <button onclick="window.location.href='dashboard.html'"
          class="bg-gradient-to-r from-[#ff0025] via-[#b80024] to-[#fca12b] hover:brightness-110 text-white text-sm font-semibold px-5 py-2 rounded-xl shadow-md transition">
          ↗ Lihat Dashboard
        </button>
        <button onclick="goBack()" class="text-red-600 text-sm font-medium hover:underline">Kembali</button>
      </div>
    </div>

    <!-- Filter Bulan -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <label for="bulanSelect" class="text-gray-700 font-semibold">Pilih Bulan:</label>
      <select id="bulanSelect" class="w-full sm:w-64 bg-red-100 text-red-700 font-semibold px-4 py-2 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500">
        <option value="all">Semua Bulan</option>
      </select>
    </div>

    <!-- Tabel -->
    <div class="overflow-x-auto rounded-xl shadow-inner max-h-[70vh]">
      <table class="scroll-table min-w-full text-sm text-gray-800">
        <thead class="bg-gray-100 sticky top-0 z-10 rounded-t-xl">
          <tr id="tableHead"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <!-- Footer -->
    <p class="text-center text-xs text-gray-400 mt-4">© 2025 Orbit Telkomsel. All rights reserved.</p>
  </div>

  <!-- Script -->
  <script>
    const data = sessionStorage.getItem('referralData');
    if (!data) {
      alert("Session kosong, kembali ke login.");
      window.location.href = 'index.html';
    }

    const parsed = JSON.parse(data);
    const head = document.getElementById('tableHead');
    const body = document.getElementById('tableBody');
    const bulanSelect = document.getElementById('bulanSelect');

    const keys = [
      'active_date', 'region', 'branch', 'cluster', 'imei', 'msisdn',
      'device_name', 'device_brand', 'digipos_id', 'referral_code',
      'referral_name', 'purchase_type', 'sales_channel', 'channel_group',
      'sales_channel_partner'
    ];

    const columnLabels = [
      'Tanggal', 'Region', 'Branch', 'Cluster', 'IMEI', 'MSISDN',
      'Device Name', 'Device Brand', 'Digipos ID', 'Referral Code',
      'Referral Name', 'Purchase Type', 'Sales Channel', 'Channel Group',
      'Sales Channel Partner'
    ];

    columnLabels.forEach(label => {
      const th = document.createElement('th');
      th.textContent = label;
      th.className = 'text-left text-gray-700 font-semibold bg-white sticky top-0';
      head.appendChild(th);
    });

    const getMonthName = num => {
      const bulan = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
      return bulan[num - 1];
    };

    const bulanSet = new Set();
    parsed.forEach(row => {
      const date = row.active_date;
      if (date && date.includes('-')) {
        const [y, m] = date.split('-');
        bulanSet.add(`${y}-${m}`);
      }
    });

    const bulanList = Array.from(bulanSet).sort();

    bulanList.forEach(bulanStr => {
      const [year, month] = bulanStr.split('-');
      const option = document.createElement('option');
      option.value = bulanStr;
      option.textContent = `${getMonthName(Number(month))} ${year}`;
      bulanSelect.appendChild(option);
    });

    bulanSelect.addEventListener('change', e => {
      const val = e.target.value;
      if (val === 'all') {
        renderTable(parsed);
      } else {
        const filtered = parsed.filter(row => row.active_date?.startsWith(val));
        renderTable(filtered);
      }
    });

    function renderTable(dataRows) {
      body.innerHTML = '';
      dataRows.forEach(row => {
        const tr = document.createElement('tr');
        keys.forEach(k => {
          const td = document.createElement('td');
          td.textContent = row[k] || '';
          td.className = 'text-gray-700';
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
    }

    function goBack() {
      sessionStorage.clear();
      window.location.href = 'dashboard.html';
    }

    renderTable(parsed);
  </script>
</body>
</html>
